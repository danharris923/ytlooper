class e{constructor(){this.defaultSettings={looperKey:"BracketLeft",latencyCompensation:50,epsilon:50,enableHoldToDefine:!1,edgeBleed:100,metronomeEnabled:!1,clicksPerLoop:4,pointAPreTrim:0,pointAPostTrim:0,pointBPreTrim:0,pointBPostTrim:150,keyBindings:{setPointA:"BracketLeft",setPointB:"BracketRight",stopLoop:"Backslash",speedUp:"Equal",speedDown:"Minus",pitchUp:"ArrowUp",pitchDown:"ArrowDown",resetPitch:"KeyR",toggleMetronome:"KeyM",jogABack:"Comma",jogAForward:"Period",jogBBack:"Semicolon",jogBForward:"Quote"}},this.saveTimeout=null,this.init()}async init(){await this.loadSettings(),this.setupEventListeners(),this.updateKeyboardShortcuts()}async loadSettings(){try{const e=await chrome.storage.sync.get(this.defaultSettings);this.populateForm(e)}catch(e){console.error("Failed to load settings:",e),this.showStatus("Failed to load settings","error")}}populateForm(e){const t=document.getElementById("settingsForm");t.elements.namedItem("latencyCompensation").value=e.latencyCompensation.toString(),t.elements.namedItem("epsilon").value=e.epsilon.toString(),t.elements.namedItem("edgeBleed").value=e.edgeBleed.toString(),t.elements.namedItem("metronomeEnabled").checked=e.metronomeEnabled,t.elements.namedItem("clicksPerLoop").value=e.clicksPerLoop.toString(),t.elements.namedItem("pointAPreTrim").value=e.pointAPreTrim.toString(),t.elements.namedItem("pointAPostTrim").value=e.pointAPostTrim.toString(),t.elements.namedItem("pointBPreTrim").value=e.pointBPreTrim.toString(),t.elements.namedItem("pointBPostTrim").value=e.pointBPostTrim.toString(),t.elements.namedItem("setPointA").value=e.keyBindings.setPointA,t.elements.namedItem("setPointB").value=e.keyBindings.setPointB,t.elements.namedItem("stopLoop").value=e.keyBindings.stopLoop,t.elements.namedItem("speedUp").value=e.keyBindings.speedUp,t.elements.namedItem("speedDown").value=e.keyBindings.speedDown,t.elements.namedItem("pitchUp").value=e.keyBindings.pitchUp,t.elements.namedItem("pitchDown").value=e.keyBindings.pitchDown,t.elements.namedItem("resetPitch").value=e.keyBindings.resetPitch,t.elements.namedItem("toggleMetronome").value=e.keyBindings.toggleMetronome,t.elements.namedItem("jogABack").value=e.keyBindings.jogABack,t.elements.namedItem("jogAForward").value=e.keyBindings.jogAForward,t.elements.namedItem("jogBBack").value=e.keyBindings.jogBBack,t.elements.namedItem("jogBForward").value=e.keyBindings.jogBForward}setupEventListeners(){const e=document.getElementById("settingsForm"),t=document.getElementById("saveBtn"),n=document.getElementById("resetBtn");e.addEventListener("input",()=>{this.debouncedSave(),this.updateKeyboardShortcuts()}),e.addEventListener("change",()=>{this.debouncedSave(),this.updateKeyboardShortcuts()}),t.addEventListener("click",()=>{this.saveSettings()}),n.addEventListener("click",()=>{this.resetToDefaults()})}debouncedSave(){this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=window.setTimeout(()=>{this.saveSettings()},500)}async saveSettings(){const e=document.getElementById("settingsForm"),t={looperKey:"BracketLeft",latencyCompensation:parseInt(e.elements.namedItem("latencyCompensation").value,10),epsilon:parseInt(e.elements.namedItem("epsilon").value,10),enableHoldToDefine:!1,edgeBleed:parseInt(e.elements.namedItem("edgeBleed").value,10),metronomeEnabled:e.elements.namedItem("metronomeEnabled").checked,clicksPerLoop:parseInt(e.elements.namedItem("clicksPerLoop").value,10),pointAPreTrim:parseInt(e.elements.namedItem("pointAPreTrim").value,10),pointAPostTrim:parseInt(e.elements.namedItem("pointAPostTrim").value,10),pointBPreTrim:parseInt(e.elements.namedItem("pointBPreTrim").value,10),pointBPostTrim:parseInt(e.elements.namedItem("pointBPostTrim").value,10),keyBindings:{setPointA:e.elements.namedItem("setPointA").value||"BracketLeft",setPointB:e.elements.namedItem("setPointB").value||"BracketRight",stopLoop:e.elements.namedItem("stopLoop").value||"Backslash",speedUp:e.elements.namedItem("speedUp").value||"Equal",speedDown:e.elements.namedItem("speedDown").value||"Minus",pitchUp:e.elements.namedItem("pitchUp").value||"ArrowUp",pitchDown:e.elements.namedItem("pitchDown").value||"ArrowDown",resetPitch:e.elements.namedItem("resetPitch").value||"KeyR",toggleMetronome:e.elements.namedItem("toggleMetronome").value||"KeyM",jogABack:e.elements.namedItem("jogABack").value||"Comma",jogAForward:e.elements.namedItem("jogAForward").value||"Period",jogBBack:e.elements.namedItem("jogBBack").value||"Semicolon",jogBForward:e.elements.namedItem("jogBForward").value||"Quote"}};if(this.validateSettings(t))try{await chrome.storage.sync.set(t),this.showStatus("Saved âœ“","success")}catch(n){console.error("Failed to save settings:",n),this.showStatus("Save failed","error")}}validateSettings(e){return e.latencyCompensation<-200||e.latencyCompensation>100?(this.showStatus("Latency compensation must be between -200 to 100ms","error"),!1):e.epsilon<1||e.epsilon>100?(this.showStatus("Epsilon must be between 1-100ms","error"),!1):e.edgeBleed<0||e.edgeBleed>300?(this.showStatus("Edge bleed must be between 0-300ms","error"),!1):e.clicksPerLoop<1||e.clicksPerLoop>64?(this.showStatus("Clicks per loop must be between 1-64","error"),!1):e.pointAPreTrim<-500||e.pointAPreTrim>500?(this.showStatus("Point A pre-trim must be between -500 to 500ms","error"),!1):e.pointAPostTrim<-500||e.pointAPostTrim>500?(this.showStatus("Point A post-trim must be between -500 to 500ms","error"),!1):e.pointBPreTrim<-500||e.pointBPreTrim>500?(this.showStatus("Point B pre-trim must be between -500 to 500ms","error"),!1):!(e.pointBPostTrim<-500||e.pointBPostTrim>500)||(this.showStatus("Point B post-trim must be between -500 to 500ms","error"),!1)}resetToDefaults(){confirm("Reset all settings to defaults? This cannot be undone.")&&(this.populateForm(this.defaultSettings),this.saveSettings(),this.updateKeyboardShortcuts())}updateKeyboardShortcuts(){}getKeyDisplayName(e){return{KeyL:"L",KeyK:"K",KeyJ:"J",KeySpace:"Space",Semicolon:";",Quote:"'",Comma:",",Period:"."}[e]||e.replace("Key","")}showStatus(e,t){const n=document.getElementById("status");n.textContent=e,n.className=`status ${t}`,t&&setTimeout(()=>{n.textContent="",n.className="status"},3e3)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new e}):new e;
